# ğŸ—ï¸ Architektura Streamware

## PrzeglÄ…d systemu

Streamware to modularna platforma AI Å‚Ä…czÄ…ca:
- **Audio processing** (STT/TTS)
- **Computer vision** (object detection)
- **Natural Language Understanding** (LLM)
- **Domain-specific actions** (Text2DSL)
- **External integrations** (Docker, MQTT, IoT)

---

## 1. PrzepÅ‚yw danych

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATA FLOW                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚   INPUT LAYER                                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚   [Microphone] â”€â”€â–º Audio Stream â”€â”€â–º VAD â”€â”€â–º STT (Whisper)            â”‚
â”‚                                              â”‚                        â”‚
â”‚   [Camera(s)] â”€â”€â–º Video Frames â”€â”€â–º YOLO â”€â”€â”€â”€â”¤                        â”‚
â”‚    â”œâ”€ USB                         Detection  â”‚                        â”‚
â”‚    â”œâ”€ RTSP                                   â”‚                        â”‚
â”‚    â””â”€ HTTP                                   â”‚                        â”‚
â”‚                                              â”‚                        â”‚
â”‚   [MQTT] â”€â”€â–º Messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚                                              â”‚                        â”‚
â”‚                                              â–¼                        â”‚
â”‚   PROCESSING LAYER                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚             â”‚                â”‚
â”‚                                       â”‚  CONTEXT    â”‚                â”‚
â”‚   Text + Vision Context â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  BUILDER    â”‚                â”‚
â”‚                                       â”‚             â”‚                â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                              â”‚                        â”‚
â”‚                                              â–¼                        â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                                       â”‚             â”‚                â”‚
â”‚                                       â”‚    LLM      â”‚                â”‚
â”‚                                       â”‚  (Ollama)   â”‚                â”‚
â”‚                                       â”‚             â”‚                â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                              â”‚                        â”‚
â”‚                                              â–¼                        â”‚
â”‚   DSL LAYER                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚             â”‚                â”‚
â”‚                                       â”‚  Text2DSL   â”‚â—„â”€â”€ Pattern     â”‚
â”‚   Natural Language â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Converter  â”‚    Matching    â”‚
â”‚                                       â”‚             â”‚                â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                              â”‚                        â”‚
â”‚                                              â–¼                        â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   ADAPTER LAYER                       â”‚   Router    â”‚                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                              â”‚                        â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                    â”‚                         â”‚                     â”‚ â”‚
â”‚                    â–¼                         â–¼                     â–¼ â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚  Docker   â”‚             â”‚   MQTT    â”‚         â”‚  Vision   â”‚
â”‚             â”‚  Adapter  â”‚             â”‚  Adapter  â”‚         â”‚  Adapter  â”‚
â”‚             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
â”‚                   â”‚                         â”‚                     â”‚ â”‚
â”‚                   â–¼                         â–¼                     â–¼ â”‚
â”‚             [Containers]              [IoT Devices]          [Cameras] â”‚
â”‚                                                                       â”‚
â”‚   OUTPUT LAYER                                                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚                                              â”‚                        â”‚
â”‚                                              â–¼                        â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   Result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Text2DSL   â”‚                â”‚
â”‚                                       â”‚  (to NL)    â”‚                â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                              â”‚                        â”‚
â”‚                                              â–¼                        â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   [Speaker] â—„â”€â”€â”€ Audio â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    TTS      â”‚                â”‚
â”‚                                       â”‚  (Piper)    â”‚                â”‚
â”‚   [MQTT] â—„â”€â”€â”€ Events                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Komponenty szczegÃ³Å‚owo

### 2.1 Audio Module

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 AUDIO MODULE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Speech-to-Text (STT)            â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ Faster-Whisper (CTranslate2)          â”‚   â”‚
â”‚  â”‚  â€¢ Models: tiny, base, small, medium     â”‚   â”‚
â”‚  â”‚  â€¢ Languages: PL, EN, auto               â”‚   â”‚
â”‚  â”‚  â€¢ VAD: WebRTC VAD                       â”‚   â”‚
â”‚  â”‚  â€¢ Streaming: chunk-based                â”‚   â”‚
â”‚  â”‚  â€¢ Latency: ~200-400ms (small model)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Text-to-Speech (TTS)            â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ Piper TTS (VITS-based)                â”‚   â”‚
â”‚  â”‚  â€¢ Polish voice: gosia-medium            â”‚   â”‚
â”‚  â”‚  â€¢ Sample rate: 22050 Hz                 â”‚   â”‚
â”‚  â”‚  â€¢ Latency: ~50-100ms                    â”‚   â”‚
â”‚  â”‚  â€¢ Fallback: espeak-ng                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Vision Module

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                VISION MODULE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Camera Manager                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Sources:                                â”‚   â”‚
â”‚  â”‚  â€¢ USB cameras (V4L2)                    â”‚   â”‚
â”‚  â”‚  â€¢ CSI cameras (Jetson)                  â”‚   â”‚
â”‚  â”‚  â€¢ RTSP streams (IP cameras)             â”‚   â”‚
â”‚  â”‚  â€¢ HTTP/MJPEG streams                    â”‚   â”‚
â”‚  â”‚  â€¢ Video files                           â”‚   â”‚
â”‚  â”‚                                          â”‚   â”‚
â”‚  â”‚  Features:                               â”‚   â”‚
â”‚  â”‚  â€¢ Multi-camera support                  â”‚   â”‚
â”‚  â”‚  â€¢ Auto-reconnect                        â”‚   â”‚
â”‚  â”‚  â€¢ GStreamer pipelines                   â”‚   â”‚
â”‚  â”‚  â€¢ Hardware decode (Jetson)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Object Detector                 â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ YOLOv8 (nano/small/medium)            â”‚   â”‚
â”‚  â”‚  â€¢ TensorRT acceleration                 â”‚   â”‚
â”‚  â”‚  â€¢ 80 COCO classes                       â”‚   â”‚
â”‚  â”‚  â€¢ Polish label translation              â”‚   â”‚
â”‚  â”‚  â€¢ Position detection (lewo/prawo/etc)   â”‚   â”‚
â”‚  â”‚  â€¢ Event-based (not every frame)         â”‚   â”‚
â”‚  â”‚  â€¢ Latency: ~20-50ms per frame           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Text2DSL Engine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               TEXT2DSL ENGINE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        Pattern Matching (Fast Path)       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Regex patterns for common commands:     â”‚   â”‚
â”‚  â”‚                                          â”‚   â”‚
â”‚  â”‚  "zrestartuj backend"                    â”‚   â”‚
â”‚  â”‚      â†“                                   â”‚   â”‚
â”‚  â”‚  {"action": "docker.restart",            â”‚   â”‚
â”‚  â”‚   "target": "backend"}                   â”‚   â”‚
â”‚  â”‚                                          â”‚   â”‚
â”‚  â”‚  "co widzisz"                            â”‚   â”‚
â”‚  â”‚      â†“                                   â”‚   â”‚
â”‚  â”‚  {"action": "vision.describe"}           â”‚   â”‚
â”‚  â”‚                                          â”‚   â”‚
â”‚  â”‚  Latency: <10ms                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                      â”‚                           â”‚
â”‚                      â”‚ No match?                 â”‚
â”‚                      â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          LLM Fallback (Slow Path)         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ Send to Ollama/Phi-3                  â”‚   â”‚
â”‚  â”‚  â€¢ Generate structured JSON              â”‚   â”‚
â”‚  â”‚  â€¢ Parse and validate                    â”‚   â”‚
â”‚  â”‚  â€¢ Latency: ~300-600ms                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Response Generation             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  DSL Result â†’ Natural Language           â”‚   â”‚
â”‚  â”‚                                          â”‚   â”‚
â”‚  â”‚  {"action": "docker.restart",            â”‚   â”‚
â”‚  â”‚   "target": "backend",                   â”‚   â”‚
â”‚  â”‚   "status": "ok"}                        â”‚   â”‚
â”‚  â”‚      â†“                                   â”‚   â”‚
â”‚  â”‚  "Kontener backend zostaÅ‚                â”‚   â”‚
â”‚  â”‚   zrestartowany pomyÅ›lnie."              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 Adapter Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ADAPTER LAYER                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Docker    â”‚  â”‚    MQTT     â”‚  â”‚ Vision  â”‚ â”‚
â”‚  â”‚   Adapter   â”‚  â”‚   Adapter   â”‚  â”‚ Adapter â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ â€¢ restart   â”‚  â”‚ â€¢ publish   â”‚  â”‚ â€¢ detectâ”‚ â”‚
â”‚  â”‚ â€¢ stop      â”‚  â”‚ â€¢ subscribe â”‚  â”‚ â€¢ find  â”‚ â”‚
â”‚  â”‚ â€¢ start     â”‚  â”‚ â€¢ on_messageâ”‚  â”‚ â€¢ count â”‚ â”‚
â”‚  â”‚ â€¢ logs      â”‚  â”‚             â”‚  â”‚ â€¢ add   â”‚ â”‚
â”‚  â”‚ â€¢ status    â”‚  â”‚             â”‚  â”‚ â€¢ removeâ”‚ â”‚
â”‚  â”‚ â€¢ inspect   â”‚  â”‚             â”‚  â”‚         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                â”‚               â”‚      â”‚
â”‚         â–¼                â–¼               â–¼      â”‚
â”‚    Docker API      MQTT Broker     OpenCV/YOLO â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Firmware   â”‚  â”‚    SQL      â”‚              â”‚
â”‚  â”‚   Adapter   â”‚  â”‚   Adapter   â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ â€¢ sensors   â”‚  â”‚ â€¢ query     â”‚              â”‚
â”‚  â”‚ â€¢ devices   â”‚  â”‚ â€¢ count     â”‚              â”‚
â”‚  â”‚ â€¢ set/get   â”‚  â”‚ â€¢ select    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                â”‚                      â”‚
â”‚         â–¼                â–¼                      â”‚
â”‚    IoT Devices       PostgreSQL                 â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Sekwencja przetwarzania

### 3.1 Komenda gÅ‚osowa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User  â”‚     â”‚ STT â”‚     â”‚Text2DSL â”‚     â”‚Adapter â”‚     â”‚   TTS   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”¬â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚             â”‚             â”‚              â”‚               â”‚
    â”‚ "Zrestartuj backend"      â”‚              â”‚               â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚              â”‚               â”‚
    â”‚             â”‚             â”‚              â”‚               â”‚
    â”‚             â”‚ transcript  â”‚              â”‚               â”‚
    â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚               â”‚
    â”‚             â”‚             â”‚              â”‚               â”‚
    â”‚             â”‚             â”‚ DSL          â”‚               â”‚
    â”‚             â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
    â”‚             â”‚             â”‚              â”‚               â”‚
    â”‚             â”‚             â”‚              â”‚ execute       â”‚
    â”‚             â”‚             â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚             â”‚             â”‚              â”‚               â”‚
    â”‚             â”‚             â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚             â”‚             â”‚              â”‚  result       â”‚
    â”‚             â”‚             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
    â”‚             â”‚             â”‚  DSL result  â”‚               â”‚
    â”‚             â”‚             â”‚              â”‚               â”‚
    â”‚             â”‚             â”‚ NL response  â”‚               â”‚
    â”‚             â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚             â”‚             â”‚              â”‚               â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  "Kontener backend zostaÅ‚ zrestartowany"                â”‚
    â”‚             â”‚             â”‚              â”‚               â”‚
```

### 3.2 Zapytanie wizyjne

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”
â”‚  User  â”‚     â”‚ STT â”‚     â”‚ Vision â”‚     â”‚Text2DSL â”‚     â”‚ TTS â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”¬â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”¬â”€â”€â”˜
    â”‚             â”‚            â”‚               â”‚              â”‚
    â”‚ "Co widzisz?"            â”‚               â”‚              â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚               â”‚              â”‚
    â”‚             â”‚            â”‚               â”‚              â”‚
    â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚
    â”‚             â”‚            â”‚               â”‚              â”‚
    â”‚             â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
    â”‚             â”‚            â”‚  get context  â”‚              â”‚
    â”‚             â”‚            â”‚               â”‚              â”‚
    â”‚             â”‚            â”‚ [osoba, kubek]â”‚              â”‚
    â”‚             â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚
    â”‚             â”‚            â”‚               â”‚              â”‚
    â”‚             â”‚            â”‚               â”‚ "WidzÄ™ osobÄ™ â”‚
    â”‚             â”‚            â”‚               â”‚  i kubek"    â”‚
    â”‚             â”‚            â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚             â”‚            â”‚               â”‚              â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  "WidzÄ™ osobÄ™ po lewej stronie i kubek na Å›rodku"      â”‚
    â”‚             â”‚            â”‚               â”‚              â”‚
```

---

## 4. Modele danych

### 4.1 DSL Command

```json
{
  "action": "docker.restart",
  "target": "backend",
  "params": {
    "timeout": 30
  },
  "_source": "pattern",
  "_raw": "zrestartuj backend"
}
```

### 4.2 Detection

```json
{
  "label": "person",
  "label_pl": "osoba",
  "confidence": 0.92,
  "bbox": [0.1, 0.2, 0.4, 0.8],
  "bbox_pixel": [64, 96, 256, 384],
  "position": "lewo",
  "camera": "usb_cam",
  "timestamp": 1703505600.123
}
```

### 4.3 Camera Config

```json
{
  "source": "rtsp://192.168.1.100:554/stream",
  "name": "ip_camera",
  "type": "rtsp",
  "width": 1280,
  "height": 720,
  "fps": 30,
  "rtsp_transport": "tcp",
  "use_gstreamer": true,
  "use_hw_decode": true,
  "reconnect": true,
  "reconnect_delay": 5.0
}
```

---

## 5. WydajnoÅ›Ä‡

### 5.1 Latencje komponentÃ³w

| Komponent | Latencja | Uwagi |
|-----------|----------|-------|
| VAD | ~10ms | WebRTC VAD |
| STT (small) | ~200-400ms | 3s audio chunk |
| Vision (YOLO) | ~20-50ms | YOLOv8n + TensorRT |
| Text2DSL (pattern) | <10ms | Regex matching |
| Text2DSL (LLM) | ~300-600ms | Phi-3 Mini |
| Adapter exec | ~50-100ms | Depends on action |
| TTS | ~50-100ms | Piper |

### 5.2 End-to-end

| Scenariusz | Latencja |
|------------|----------|
| Prosta komenda (pattern) | ~500-700ms |
| Komenda + LLM fallback | ~800-1200ms |
| Zapytanie wizyjne | ~600-900ms |

### 5.3 Zasoby

| Konfiguracja | RAM | GPU |
|--------------|-----|-----|
| Minimal | ~4GB | - |
| Standard | ~6GB | 4GB VRAM |
| Full (multi-cam) | ~8GB | 6GB VRAM |
